<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Categoria</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    body {
      display: flex;
      flex-direction: row;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f9fff3;
      overflow: hidden;
    }

    .sidebar {
      width: 220px;
      background-color: #c8e0a4;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
    }

    .main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 20px;
    }

    h1 { margin-bottom: 20px; }

    .flashcard {
      width: 450px;
      height: 600px;
      background: #c8e0a4;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      perspective: 1500px;
      position: relative;
      cursor: grab;
      user-select: none;
      transition: transform 0.4s ease;
    }

    .flashcard-inner {
      position: absolute;
      width: 100%;
      height: 100%;
      transition: transform 0.9s cubic-bezier(0.4, 0.2, 0.2, 1);
      transform-style: preserve-3d;
    }

    .flashcard.is-flipped .flashcard-inner {
      transform: rotateY(180deg);
    }

    .flashcard-front, .flashcard-back {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      padding: 30px;
      backface-visibility: hidden;
      border-radius: 20px;
      box-sizing: border-box;
    }

    .flashcard-front { background: #c8e0a4; }
    .flashcard-back { background: #a8c67a; transform: rotateY(180deg); }

    .hover-icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%) scale(0);
      opacity: 0;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      color: white;
      font-size: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
    }

    .hover-icon.right { right: -100px; background: #4CAF50; }
    .hover-icon.left { left: -100px; background: #E74C3C; }

    @keyframes symbolFromBehind {
      0% { opacity: 0; transform: translateZ(-120px) translateY(-50%) scale(0.5); }
      60% { opacity: 1; transform: translateZ(40px) translateY(-50%) scale(1.1); }
      100% { transform: translateZ(0) translateY(-50%) scale(1); opacity: 1; }
    }

    .flashcard:hover .hover-icon.right {
      animation: symbolFromBehind 0.6s forwards;
    }
    .flashcard:hover .hover-icon.left {
      animation: symbolFromBehind 0.6s forwards;
    }

    .flashcard.left-hover { transform: rotate(-6deg) translateX(-10px); }
    .flashcard.right-hover { transform: rotate(6deg) translateX(10px); }

    .flashcard.throw-right { animation: throwRight 0.6s ease-out forwards; }
    .flashcard.throw-left { animation: throwLeft 0.6s ease-out forwards; }

    @keyframes throwRight {
      0% { transform: translateX(0) rotate(0deg); opacity: 1; }
      100% { transform: translateX(600px) rotate(20deg); opacity: 0; }
    }
    @keyframes throwLeft {
      0% { transform: translateX(0) rotate(0deg); opacity: 1; }
      100% { transform: translateX(-600px) rotate(-20deg); opacity: 0; }
    }

    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 50px;
      height: 50px;
      background: #c8e0a4;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: background 0.3s;
      z-index: 10;
    }

    .arrow:hover { background: #b1d084; }
    .arrow svg { width: 24px; height: 24px; fill: #333; }
    .arrow.left { left: 60px; }
    .arrow.right { right: 60px; }

    .add-flashcard-btn {
      position: absolute;
      top: 20px;
      right: 40px;
      background: #a8c67a;
      color: #fff;
      text-decoration: none;
      padding: 10px 16px;
      border-radius: 8px;
      transition: background 0.3s;
    }
    .add-flashcard-btn:hover { background: #91b268; }

    .scoreboard {
      position: absolute;
      bottom: 20px;
      display: flex;
      gap: 30px;
      font-size: 1.2rem;
      align-items: center;
      justify-content: center;
    }

    .score-item { display: flex; align-items: center; gap: 8px; }
    .score-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
    }
    .score-circle.correct { background: #4CAF50; }
    .score-circle.wrong { background: #E74C3C; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>MedVest+</h2>
    <a href="/index.html" class="nav-link">In√≠cio</a>
    <a href="./simulados.html" class="nav-link">Simulados</a>
    <a href="./flashcards.html" class="nav-link">Flashcards</a>
    <a href="./notificacoes.html" class="nav-link">Notifica√ß√µes</a>
    <a href="./perfil.html" class="nav-link">Perfil</a>
    <img src="/assets/images/logo.png" alt="logo">
  </div>

  <div class="main">
    <h1 id="categoryTitle"></h1>
    <a href="#" id="addFlashcardBtn" class="add-flashcard-btn">+ Novo Flashcard</a>
    <div id="flashcardContainer"></div>

    <div class="arrow left" id="prevBtn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </div>
    <div class="arrow right" id="nextBtn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
    </div>

    <div class="scoreboard">
      <div class="score-item">
        <div class="score-circle correct">‚úî</div>
        <span id="correctCount">0</span>
      </div>
      <div class="score-item">
        <div class="score-circle wrong">‚úñ</div>
        <span id="wrongCount">0</span>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const nome = params.get("nome");
    const tipo = params.get("tipo");
    const storageKey = "flashcards_" + nome + "_" + tipo;

    document.getElementById("categoryTitle").textContent = nome;

    const flashcards = JSON.parse(localStorage.getItem(storageKey)) || [];
    const container = document.getElementById("flashcardContainer");
    const correctCountEl = document.getElementById("correctCount");
    const wrongCountEl = document.getElementById("wrongCount");
    let currentIndex = 0;
    let correctCount = 0;
    let wrongCount = 0;

    function renderFlashcard(index) {
      container.innerHTML = "";
      if (flashcards.length === 0) {
        container.innerHTML = "<p>N√£o h√° flashcards nesta categoria.</p>";
        return;
      }

      const fc = flashcards[index];
      const div = document.createElement("div");
      div.className = "flashcard";
      div.innerHTML = `
        <div class="flashcard-inner">
          <div class="flashcard-front">${fc.front}</div>
          <div class="flashcard-back">${fc.back}</div>
        </div>
        <div class="hover-icon left">‚úñ</div>
        <div class="hover-icon right">‚úî</div>
      `;

      div.addEventListener("click", (e) => {
        if (Math.abs(e.offsetX - div.offsetWidth / 2) < 200) {
          div.classList.toggle("is-flipped");
        }
      });

      // üîπ Altera√ß√£o: o meio n√£o inclina mais
      div.addEventListener("mousemove", (e) => {
        const rect = div.getBoundingClientRect();
        const mid = rect.left + rect.width / 2;
        const diff = e.clientX - mid;
        const maxTilt = 8;
        const distanceFromCenter = Math.abs(diff);

        // O centro permanece neutro (sem rota√ß√£o at√© 100px do meio)
        let tilt = 0;
        if (distanceFromCenter > 100) {
          const factor = (distanceFromCenter - 100) / (rect.width / 2 - 100);
          tilt = Math.sign(diff) * Math.min(maxTilt, factor * maxTilt);
        }

        div.style.transform = `rotate(${tilt}deg)`;
      });

      div.addEventListener("mouseleave", () => {
        div.style.transform = "rotate(0deg)";
      });

      let startX = 0;
      let isDragging = false;

      div.addEventListener("mousedown", (e) => {
        startX = e.clientX;
        isDragging = true;
        div.style.transition = "none";
      });

      document.addEventListener("mouseup", (e) => {
        if (!isDragging) return;
        isDragging = false;
        div.style.transition = "transform 0.3s ease";

        const diff = e.clientX - startX;
        if (diff > 100) {
          div.classList.add("throw-right");
          setTimeout(() => {
            correctCount++;
            correctCountEl.textContent = correctCount;
            nextFlashcard();
          }, 400);
        } else if (diff < -100) {
          div.classList.add("throw-left");
          setTimeout(() => {
            wrongCount++;
            wrongCountEl.textContent = wrongCount;
            nextFlashcard();
          }, 400);
        } else {
          div.style.transform = "translateX(0) rotate(0)";
        }
      });

      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        const diff = e.clientX - startX;
        const tilt = Math.max(-10, Math.min(10, diff / 15));
        div.style.transform = `translateX(${diff}px) rotate(${tilt}deg)`;
      });

      container.appendChild(div);
    }

    function nextFlashcard() {
      if (flashcards.length === 0) return;
      currentIndex = (currentIndex + 1) % flashcards.length;
      renderFlashcard(currentIndex);
    }

    document.getElementById("prevBtn").addEventListener("click", () => {
      if (flashcards.length === 0) return;
      currentIndex = (currentIndex - 1 + flashcards.length) % flashcards.length;
      renderFlashcard(currentIndex);
    });

    document.getElementById("nextBtn").addEventListener("click", nextFlashcard);

    const addBtn = document.getElementById("addFlashcardBtn");
    addBtn.href = "novoflashcard.html?nome=" + encodeURIComponent(nome) + "&tipo=" + encodeURIComponent(tipo);

    renderFlashcard(currentIndex);
  </script>
</body>
</html>
